function renderAnimation(animation_path, t_hist, x_f16_hist, flightLimits)
% Animates and saves a 3D animation of the aircraft path and attitude
% throughout the maneuver. Pass/fail conditions are displayed in the image.
% This script requires that "SimResults.mat" exists in the workspace. This
% .mat file is automatically generated by RunF16Sim with the variable
% "analysisOn" set to true.
%
% <a href="https://github.com/pheidlauf/AeroBenchVV">AeroBenchVV</a>
% Copyright: GNU General Public License 2017
%
% See also: RUNF16SIM, NEW_OBJECT, FLYPATH

%% Create animation of F16 Maneuver

% Run required package_setup for flypath3d
aerobench_path = getAeroBenchPath();
flypath_setup = fullfile(aerobench_path,...
    'src','main','viewers','flypath3d','package_setup.m');
run(flypath_setup)

% Flypath3D Trajectory Visualization
% East North Up Pitch Yaw Roll
trajectory = x_f16_hist([11 10 12 5 6 4],:);

figure

% Create an object
new_object('aircraft.mat',trajectory,...
    'model','f-16.mat','scale', 25,...
    'edge',[0 0 0],'face',[0 0 0],'alpha',1,...
    'path','on','pathcolor',[.89 .0 .27],'pathwidth',1);

% Aircraft trajectory visualization
my_flypath('aircraft.mat',...
    'tvec',t_hist,...
    'ground',output.flightLimits.altitudeMin,...
    'animate','on','step', 5,...
    'axis','on','axiscolor',[0 0 0],'color',[1 1 1],...
    'font','Georgia','fontsize',6,...
    'view', [-37.5, 30],'window',[1000 1000],...
    'output', strcat(animation_path, '.mp4'),'dpi',600,...
    'telemetry',output,'zoom',2500);

view(3);
close all;